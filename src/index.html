<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Screen Recorder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #2d2d2d;
            color: #ffffff;
            user-select: none;
            border-radius: 12px;
            overflow: hidden;
        }

        /* Header / Title Bar */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background-color: #222222;
            -webkit-app-region: drag;
            border-radius: 12px 12px 0px 0px;
        }

        .capture-btn {
            background-color: #0c6d1a;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            -webkit-app-region: no-drag;
            transition: background-color 0.2s;
        }

        .capture-btn:hover {
            background-color: #4caf50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .path-select {
            background-color: #0c6d1a;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            -webkit-app-region: no-drag;
            transition: background-color 0.2s;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='white' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
        }

        .path-select:hover {
            background-color: #4caf50;
        }

        .path-select:focus {
            outline: none;
            background-color: #4caf50;
        }

        .path-select option {
            background-color: #2d2d2d;
            color: white;
            padding: 8px;
        }

        .path-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-app-region: no-drag;
        }

        .path-label {
            font-size: 11px;
            color: #4caf50;
            margin-top: 4px;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
        }

        .window-controls {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }

        .window-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            /* background-color: #4a4a4a; */
            background-color: #373737;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: background-color 0.2s;
        }

        .window-btn:hover {
            background-color: #5a5a5a;
        }

        /* Main Content */
        .content {
            padding: 20px;
            border-radius: 0px 0px 12px 12px;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 60px);
            overflow: hidden;
        }

        #files {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .section-title {
            font-size: 14px;
            color: #b0b0b0;
            margin-bottom: 12px;
        }

        /* Capture Area Options */
        .capture-options {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
        }

        .capture-option {
            flex: 1;
            padding: 16px 12px;
            background-color: #4a4a4a;
            border: none;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .capture-option:hover {
            background-color: #5a5a5a;
        }

        .capture-option.active {
            background-color: #1a1a1a;
        }

        .capture-option svg {
            width: 32px;
            height: 32px;
        }

        .capture-option span {
            font-size: 13px;
        }

        /* Settings Panel */
        .settings-panel {
            background-color: #3a3a3a;
            border-radius: 8px;
            overflow: hidden;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid #4a4a4a;
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 50px;
            height: 28px;
            background-color: #666;
            border-radius: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .toggle.active {
            background-color: #4caf50;
        }

        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background-color: #ffffff;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle.active .toggle-knob {
            transform: translateX(22px);
        }

        /* Counter */
        .counter {
            display: flex;
            align-items: center;
            gap: 0;
            background-color: #4a4a4a;
            border-radius: 6px;
            overflow: hidden;
        }

        .counter-value {
            width: 40px;
            text-align: center;
            font-size: 16px;
            padding: 8px 0;
            background-color: #3a3a3a;
        }

        .counter-btn {
            width: 36px;
            height: 36px;
            border: none;
            background-color: #4a4a4a;
            color: #888;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.2s, color 0.2s;
        }

        .counter-btn:hover {
            background-color: #5a5a5a;
            color: #fff;
        }
    </style>
    <style>
        #region-selector {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  cursor: crosshair;
}

#region-selector .screenshot-bg {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.7);
}

#region-selector .selection-box {
  display: none;
  position: absolute;
  border: 2px dashed #00ff00;
  background: rgba(0, 255, 0, 0.1);
  pointer-events: none;
}

#region-selector .instructions {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
}

.source-picker .source-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
}

.source-item {
  cursor: pointer;
  border: 2px solid transparent;
  border-radius: 8px;
  padding: 8px;
  transition: border-color 0.2s;
}

.source-item:hover {
  border-color: #007bff;
}

.source-item img {
  width: 100%;
  border-radius: 4px;
}

@keyframes flashFade {
  0% {
    opacity: 0.8;
  }
  100% {
    opacity: 0;
  }
}

/* Folders Section */
.folders-section {
    display: none;
}

.folders-section.active {
    display: block;
}

.capture-section {
    display: block;
}

.capture-section.hidden {
    display: none;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.new-path-btn {
    background-color: #0c6d1a;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.new-path-btn:hover {
    background-color: #4caf50;
}

.paths-table {
    width: 100%;
    border-collapse: collapse;
    background-color: #3a3a3a;
    border-radius: 8px;
    overflow: hidden;
}

.paths-table th,
.paths-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #4a4a4a;
}

.paths-table th {
    background-color: #2a2a2a;
    font-size: 12px;
    color: #b0b0b0;
    font-weight: 500;
}

.paths-table td {
    font-size: 13px;
}

.paths-table tr:last-child td {
    border-bottom: none;
}

.paths-table tr:hover {
    background-color: #444444;
}

.delete-btn {
    background-color: #d32f2f;
    color: white;
    border: none;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 11px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.delete-btn:hover {
    background-color: #f44336;
}

.delete-btn:disabled {
    background-color: #666;
    cursor: not-allowed;
}

/* New Path Modal */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-overlay.active {
    display: flex;
}

.modal {
    background-color: #2d2d2d;
    border-radius: 8px;
    padding: 20px;
    width: 300px;
}

.modal-title {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 16px;
}

.modal-input {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 6px;
    background-color: #3a3a3a;
    color: white;
    font-size: 14px;
    margin-bottom: 12px;
    box-sizing: border-box;
}

.modal-input:focus {
    outline: 2px solid #4caf50;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.modal-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.modal-btn.cancel {
    background-color: #4a4a4a;
    color: white;
}

.modal-btn.cancel:hover {
    background-color: #5a5a5a;
}

.modal-btn.save {
    background-color: #0c6d1a;
    color: white;
}

.modal-btn.save:hover {
    background-color: #4caf50;
}

.path-selector {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.path-selector .path-input {
    flex: 1;
    margin-bottom: 0;
    cursor: pointer;
}

.browse-btn {
    padding: 10px 14px;
    border: none;
    border-radius: 6px;
    background-color: #4a4a4a;
    color: white;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.2s;
    white-space: nowrap;
}

.browse-btn:hover {
    background-color: #5a5a5a;
}

.back-btn {
    margin-top: 16px;
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    background-color: #4a4a4a;
    color: white;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.back-btn:hover {
    background-color: #5a5a5a;
}
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="capture-btn" id="captureBtn">Capturar</button>
            <div class="path-container">
                <select class="path-select" name="pathSelect" id="pathSelect">
                </select>
            </div>
        </div> 
        <div class="window-controls">
            <button class="window-btn" id="menuBtn">üìÅ</button>
            <button class="window-btn" id="minimizeBtn">‚àí</button>
            <button class="window-btn" id="closeBtn">√ó</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content">
        <!-- Capture Section -->
        <div class="capture-section" id="captureSection">
            <div class="section-title">√Årea de captura</div>

            <!-- Capture Options -->
            <div class="capture-options">
                <button class="capture-option active" data-mode="selection" id="selection">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" stroke-dasharray="4 2"/>
                        <rect x="8" y="8" width="8" height="8" fill="currentColor" opacity="0.3"/>
                    </svg>
                    <span>Selecci√≥n</span>
                </button>
                <button class="capture-option" data-mode="screen" id="screen">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <rect x="2" y="3" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2"/>
                        <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Pantalla</span>
                </button>
                <button class="capture-option" data-mode="window" id="window">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                    </svg>
                    <span>Ventana</span>
                </button>
            </div>
        </div>

        <!-- Folders Section -->
        <div class="folders-section" id="foldersSection">
            <div class="section-header">
                <div class="section-title">Folders</div>
                <button class="new-path-btn" id="newPathBtn">+ New Path</button>
            </div>
            <table class="paths-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Path</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="pathsTableBody">
                    <!-- Paths will be populated by JavaScript -->
                </tbody>
            </table>
            <button class="back-btn" id="backToCapture">‚Üê Back</button>
        </div>

        <!-- Settings -->
        <!-- <div class="settings-panel">
            <div class="setting-row">
                <span class="setting-label">Mostrar puntero</span>
                <div class="toggle active" id="showPointerToggle">
                    <div class="toggle-knob"></div>
                </div>
            </div>
            <div class="setting-row">
                <span class="setting-label">Retardo, en segundos</span>
                <div class="counter">
                    <span class="counter-value" id="delayValue">0</span>
                    <button class="counter-btn" id="decreaseDelay">‚àí</button>
                    <button class="counter-btn" id="increaseDelay">+</button>
                </div>
            </div>
        </div> -->

        <!-- Files to shown -->
        <div id="files">
        </div>

    </div>

    <!-- New Path Modal -->
    <div class="modal-overlay" id="newPathModal">
        <div class="modal">
            <div class="modal-title">New Path</div>
            <input type="text" class="modal-input" id="newPathName" placeholder="Name (e.g., Desktop)">
            <div class="path-selector">
                <input type="text" class="modal-input path-input" id="newPathPath" placeholder="Select a folder..." readonly>
                <button class="browse-btn" id="browsePathBtn">Browse</button>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelNewPath">Cancel</button>
                <button class="modal-btn save" id="saveNewPath">Save</button>
            </div>
        </div>
    </div>

    <script src="../renderers/renderer.js"></script>
    <script src="../renderers/screen-renderer.js"></script>
    <script>
        // Capture mode selection
        const captureOptions = document.querySelectorAll('.capture-option');
        captureOptions.forEach(option => {
            option.addEventListener('click', () => {
                captureOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
            });
        });

        // Toggle switch (commented out in HTML)
        const toggle = document.getElementById('showPointerToggle');
        if (toggle) {
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
            });
        }

        // Delay counter (commented out in HTML)
        const delayValue = document.getElementById('delayValue');
        const decreaseBtn = document.getElementById('decreaseDelay');
        const increaseBtn = document.getElementById('increaseDelay');
        let delay = 0;

        if (decreaseBtn) {
            decreaseBtn.addEventListener('click', () => {
                if (delay > 0) {
                    delay--;
                    if (delayValue) delayValue.textContent = delay;
                }
            });
        }

        if (increaseBtn) {
            increaseBtn.addEventListener('click', () => {
                delay++;
                if (delayValue) delayValue.textContent = delay;
            });
        }

        // Window controls (for Electron)
        document.getElementById('closeBtn').addEventListener('click', () => {
            if (window.electronAPI) {
                window.electronAPI.closeWindow();
            }
        });

        document.getElementById('minimizeBtn').addEventListener('click', () => {
            if (window.electronAPI) {
                window.electronAPI.minimizeWindow();
            }
        });

        // Path select functionality
        const pathSelect = document.getElementById('pathSelect');
        const pathLabel = document.getElementById('pathLabel');
        let currentPaths = [];

        function updatePathLabel(pathId) {
            const selected = currentPaths.find(p => p.id === pathId);
            if (selected && pathLabel) {
                pathLabel.textContent = `${selected.namePath}: ${selected.path}`;
                pathLabel.title = selected.path; // tooltip for full path
            }
        }

        async function populatePathSelect() {
            if (!window.pathsAPI) {
                console.log('pathsAPI not available yet');
                return;
            }

            try {
                currentPaths = await window.pathsAPI.getPaths();
                const selectedPathId = await window.pathsAPI.getSelectedPathId();

                pathSelect.innerHTML = '';

                currentPaths.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = `${p.namePath}`;
                    option.selected = p.id === selectedPathId;
                    pathSelect.appendChild(option);
                });

                updatePathLabel(selectedPathId);
            } catch (err) {
                console.error('Error loading paths:', err);
            }
        }

        pathSelect.addEventListener('change', (e) => {
            if (window.pathsAPI) {
                window.pathsAPI.setSelectedPathId(e.target.value);
                updatePathLabel(e.target.value);
            }
        });

        // Initialize path select on load
        populatePathSelect();

        // ============================================
        // Menu button - Toggle between sections
        // ============================================
        const menuBtn = document.getElementById('menuBtn');
        const captureSection = document.getElementById('captureSection');
        const foldersSection = document.getElementById('foldersSection');
        const filesDiv = document.getElementById('files');
        let showingFolders = false;

        menuBtn.addEventListener('click', () => {
            showingFolders = !showingFolders;

            if (showingFolders) {
                captureSection.classList.add('hidden');
                filesDiv.style.display = 'none';
                foldersSection.classList.add('active');
                populatePathsTable();
            } else {
                captureSection.classList.remove('hidden');
                filesDiv.style.display = 'block';
                foldersSection.classList.remove('active');
            }
        });

        // Back button - return to capture area
        const backToCapture = document.getElementById('backToCapture');
        backToCapture.addEventListener('click', () => {
            showingFolders = false;
            captureSection.classList.remove('hidden');
            filesDiv.style.display = 'block';
            foldersSection.classList.remove('active');
        });

        // ============================================
        // Folders Table
        // ============================================
        const pathsTableBody = document.getElementById('pathsTableBody');

        async function populatePathsTable() {
            if (!window.pathsAPI) return;

            try {
                const paths = await window.pathsAPI.getPaths();
                pathsTableBody.innerHTML = '';

                paths.forEach(p => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${p.namePath}</td>
                        <td>${p.path}</td>
                        <td>
                            <button class="delete-btn" data-id="${p.id}" ${p.id === 'default' ? 'disabled' : ''}>
                                Delete
                            </button>
                        </td>
                    `;
                    pathsTableBody.appendChild(tr);
                });

                // Add delete event listeners
                pathsTableBody.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const pathId = e.target.dataset.id;
                        if (pathId && pathId !== 'default') {
                            await window.pathsAPI.removePath(pathId);
                            populatePathsTable();
                            populatePathSelect();
                        }
                    });
                });
            } catch (err) {
                console.error('Error loading paths table:', err);
            }
        }

        // ============================================
        // New Path Modal
        // ============================================
        const newPathModal = document.getElementById('newPathModal');
        const newPathBtn = document.getElementById('newPathBtn');
        const cancelNewPath = document.getElementById('cancelNewPath');
        const saveNewPath = document.getElementById('saveNewPath');
        const newPathName = document.getElementById('newPathName');
        const newPathPath = document.getElementById('newPathPath');
        const browsePathBtn = document.getElementById('browsePathBtn');

        // Browse button - open folder dialog
        browsePathBtn.addEventListener('click', async () => {
            const selectedPath = await window.pathsAPI.selectFolder();
            if (selectedPath) {
                newPathPath.value = selectedPath;
            }
        });

        // Also allow clicking on the input to browse
        newPathPath.addEventListener('click', async () => {
            const selectedPath = await window.pathsAPI.selectFolder();
            if (selectedPath) {
                newPathPath.value = selectedPath;
            }
        });

        newPathBtn.addEventListener('click', () => {
            newPathModal.classList.add('active');
            newPathName.value = '';
            newPathPath.value = '';
            newPathName.focus();
        });

        cancelNewPath.addEventListener('click', () => {
            newPathModal.classList.remove('active');
        });

        newPathModal.addEventListener('click', (e) => {
            if (e.target === newPathModal) {
                newPathModal.classList.remove('active');
            }
        });

        saveNewPath.addEventListener('click', async () => {
            const name = newPathName.value.trim();
            const path = newPathPath.value.trim();

            if (!name || !path) {
                alert('Please fill in both fields');
                return;
            }

            // Ensure path ends with /
            const finalPath = path.endsWith('/') ? path : path + '/';

            const newPath = {
                id: `path-${Date.now()}`,
                namePath: name,
                path: finalPath
            };

            await window.pathsAPI.addPath(newPath);
            newPathModal.classList.remove('active');
            populatePathsTable();
            populatePathSelect();
        });
    </script>
</body>
</html>
